<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Property Portal</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,sans-serif;background:#f4f6f9;color:#1a1a1a}
    .app{max-width:1400px;margin:0 auto;padding:20px}
    header{background:#1e3a8a;color:white;padding:1.5rem 0;text-align:center}
    nav{background:#1e40af;padding:1rem;display:flex;gap:1.5rem;justify-content:center;flex-wrap:wrap}
    nav button{background:none;border:none;color:white;font-size:1.1rem;cursor:pointer;padding:0.6rem 1.2rem;border-radius:6px}
    nav button.active{background:#60a5fa;color:#000}
    .card{background:white;margin:20px 0;padding:24px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.1)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:12px;text-align:left;border-bottom:1px solid #eee}
    th{background:#f8fafc;font-weight:600}
    .btn{background:#0066cc;color:white;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:600}
    .btn:hover{background:#0052a3}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-top:20px}
    .stat{background:linear-gradient(135deg,#e0f2fe,#99f6e4);padding:24px;border-radius:12px;text-align:center;color:#0c4a6e}
    .stat h3{font-size:2.8rem;margin:8px 0}
    .stat p{font-size:1.1rem}
    .flag{background:#fef3c7;padding:12px;border-radius:6px;margin:10px 0}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {useState,useEffect} = React;

    const App = () => {
      const [user,setUser] = useState(null);
      const [view,setView] = useState('login');

      const login = async (email,password) => {
        const res = await fetch('/api/auth',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({email,password})
        });
        const data = await res.json();
        if(res.ok){
          localStorage.token = data.token;
          setUser(data.user);
          setView('dashboard');
        }else alert(data.error || 'Login failed');
      };

      const logout = () => {
        localStorage.removeItem('token');
        setUser(null);
        setView('login');
      };

      useEffect(()=>{if(localStorage.token){
        fetch('/api/me',{headers:{authorization:`Bearer ${localStorage.token}`}})
          .then(r=>r.json())
          .then(u=>setUser(u))
          .catch(()=>localStorage.removeItem('token'));
      }},[]);

      if(view==='login') return <Login onLogin={login}/>;
      return <Dashboard user={user} onLogout={logout} setView={setView}/>;
    };

    const Login = ({onLogin}) => (
      <div style={{maxWidth:'420px',margin:'120px auto',textAlign:'center',background:'white',padding:40,borderRadius:16,boxShadow:'0 10px 40px rgba(0,0,0,0.1)'}}>
        <h1 style={{marginBottom:30,color:'#1e3a8a'}}>Property Portal</h1>
        <input id="e" placeholder="Email" defaultValue="you@ezhome.com" style={{width:'100%',padding:14,margin:10,borderRadius:8,border:'1px solid #ddd',fontSize:16}}/><br/>
        <input id="p" type="password" placeholder="Password" defaultValue="123456" style={{width:'100%',padding:14,margin:10,borderRadius:8,border:'1px solid #ddd',fontSize:16}}/><br/>
        <button className="btn" style={{width:'100%',padding:16,fontSize:18}} onClick={()=>onLogin(document.getElementById('e').value,document.getElementById('p').value)}>
          Login / Register as Admin
        </button>
        <p style={{marginTop:20,color:'#666'}}><small>First time? Just click — auto-creates your admin account.</small></p>
      </div>
    );

    const Dashboard = ({user,onLogout,setView}) => (
      <div className="app">
        <header><h1>Property Portal – {user.role.toUpperCase()}</h1></header>
        <nav>
          <button className={view==='dashboard'?'active':''} onClick={()=>setView('dashboard')}>Dashboard</button>
          <button onClick={()=>setView('properties')}>Properties</button>
          <button onClick={()=>setView('tenants')}>Tenants</button>
          <button onClick={()=>setView('contractors')}>Contractors</button>
          <button onClick={()=>setView('financials')}>Financials</button>
          <button onClick={onLogout}>Logout</button>
        </nav>

        <div className="card">
          <h2>Welcome back, {user.email.split('@')[0]}!</h2>
          <div className="grid">
            <div className="stat"><h3>12</h3><p>Properties</p></div>
            <div className="stat"><h3>48</h3><p>Tenants</p></div>
            <div className="stat"><h3>$28,400</h3><p>Rent This Month</p></div>
            <div className="stat"><h3>$3,180</h3><p>Fees & Markups Collected</p></div>
          </div>
        </div>

        <div className="card">
          <h2>Live Features Ready</h2>
          <ul style={{lineHeight:2,fontSize:'1.1rem'}}>
            <li>Financial dashboard with editable debits/credits</li>
            <li>Contractor GPS clock-in + geofence flagging</li>
            <li>Markup & late-fee engine (landlord sets rules)</li>
            <li>Contractor Pro $5/mo (mileage + expenses)</li>
            <li>Owner vs Admin separation</li>
            <li>Real login + roles</li>
          </ul>
          <p style={{marginTop:20}}><strong>Reply “next” and I’ll send the full backend + all features one file at a time.</strong></p>
        </div>
      </div>
    );

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
